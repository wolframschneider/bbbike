#!/usr/bin/perl -w
# -*- perl -*-

#
# Author: Slaven Rezic
#
# Copyright (C) 2008,2014 Slaven Rezic. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.
#
# Mail: slaven@rezic.de
# WWW:  http://www.rezic.de/eserte/
#

use strict;
use FindBin;
use lib ("$FindBin::RealBin/..",
	 "$FindBin::RealBin/../lib",
	);

use Getopt::Long;

use GPS::GpsmanData::Any;

sub usage (;$) {
    my $msg = shift;
    print STDERR $msg, "\n" if $msg;
    die <<EOF;
usage: $0 [--check-roundtrip] gpxfile
EOF
}

my $do_check_roundtrip;
GetOptions('check-roundtrip!' => \$do_check_roundtrip)
    or die usage;
my $file = shift
    or usage "Please specify gpx file";

if ($do_check_roundtrip) {
    require GPS::GpsmanData::TestRoundtrip;
    my $success = GPS::GpsmanData::TestRoundtrip::gpx2gpsman2gpx($file);
    exit($success ? 0 : 1);
} else {
    my $gpsman = GPS::GpsmanData::Any->load($file);
    print $gpsman->as_string;
}

__END__
