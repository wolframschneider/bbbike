#!/usr/bin/perl -w
# -*- perl -*-

#
# $Id: downloadosm,v 1.1 2008/01/12 17:04:40 eserte Exp $
# Author: Slaven Rezic
#
# Copyright (C) 2008 Slaven Rezic. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.
#
# Mail: slaven@rezic.de
# WWW:  http://www.rezic.de/eserte/
#

use strict;
use LWP::UserAgent;

my $ua = LWP::UserAgent->new;

my @bbox = @ARGV;
if (@bbox != 4) {
    die "Please specify a bbox (four parameters)";
}

my($x1,$y1,$x2,$y2) = @bbox;
my $xstep = 0.01;
my $ystep = 0.01;

die "ERROR: x1 > x2" if $x1 > $x2;
die "ERROR: y1 > y2" if $y1 > $y2;

for(my $x = $x1; $x <= $x2; $x+=$xstep) {
    for(my $y = $y1; $y <= $y2; $y+=$ystep) {
	my $xend = $x+$xstep;
	my $yend = $y+$ystep;
	my $url = "http://www.openstreetmap.org/api/0.5/map?bbox=$x,$y,$xend,$yend";
	my $dest = "download_$x,$y,$xend,$yend.osm";
	if (-s $dest) {
	    warn "$dest already exists, skipping...\n";
	} else {
	    my @cmd = ('wget', '--verbose', '-O', $dest, $url);
	    #warn "@cmd\n";
	    system @cmd;
	}
    } 
}

__END__
