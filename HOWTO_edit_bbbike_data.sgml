<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V3.1-Based Extension//EN" [

<!ENTITY % ISOlat2 PUBLIC
       "ISO 8879:1986//ENTITIES Added Latin 2//EN">
%ISOlat2;

<!ENTITY % man PUBLIC "-//FreeBSD//ENTITIES DocBook Manual Page Entities//EN">
%man;

]>

<!-- $Id: HOWTO_edit_bbbike_data.sgml,v 1.8 2005/08/30 23:18:16 eserte Exp $ -->

<article>
 <artheader>
  <title>HOWTO - Daten in BBBike editieren</title>

  <authorgroup>
   <author>
    <firstname>Slaven</firstname>
    <!-- eigentlich &ccaron; -->
    <surname>Rezic</surname>
    <affiliation>
     <address>
      <email>slaven@rezic.de</email>
     </address>
    </affiliation>
   </author>
  </authorgroup>

  <pubdate>$Date: 2005/08/30 23:18:16 $</pubdate>

  <copyright>
   <year>2005</year>
   <holder>Slaven Rezic</holder>
  </copyright>

<!--
  <abstract>
   <para>
   </para>
  </abstact>
-->
 </artheader>

<sect1>
<title>Voraussetzungen</>

<sect2>
<title>Betriebssystem</>

<para>
Empfehlenswert ist ein POSIX-kompatibles System, also Linux oder Unix.
</para>

<para>
Bei Windows könnte es helfen, wenn <ulink
url="http://www.cygwin.com">cygwin</> installiert ist (die
Basis-Installation von cygwin zusammen mit <command>cvs</> dürfte
ausreichen). Die Umgebungsvariable <envar>PATH</> sollte um den
bin-Pfad von cygwin ergänzt werden (üblicherweise
<filename>C:\cygwin\bin</>), falls das nicht automatisch bei der
cygwin-Installation gemacht wird.
</para>

<sect2>
<title>CVS</>

<para>
Ein CVS-Checkout von BBBike ist notwendig, um die neuesten Daten sowie
die aktuellsten Entwicklungstools zu erhalten. Eine Anleitung für das
CVS-Checkout befindet sich unter <ulink
url="REAMDE.html#Entwicklung">Entwicklung im README</>.
Windows-Benutzer sollten das Verzeichnis aus dem CVS-Checkout an die
Stelle des originalen BBBike-Programmverzeichnisses verschieben, also
üblicherweise <filename>C:\Programme\BBBike\bbbike\</>.
</para>

<!--
XXX Nightly tarball @ sourceforge als Alternative erwähnen?
-->

<sect1>
<title>BBBike starten</>

<para id="bbbikeadvanced">
BBBike sollte mit der Option <command>-advanced</> gestartet werden
--- entweder in der Kommandozeile angeben oder in den Option unter
"Advanced" den Knopf "advanced" anklicken. Nach dem Ändern der Option
ist ein Neustart erforderlich. Mit der Option <command>-advanced</>
erhält man u.a. neue Menüs, die bei der Datenerfassung helfen.
</para>

<sect1>
<title>Editiermodus</>

<para>
Einschalten des EDIT-Modus durch Klick auf den EDIT-Button unten
rechts. Die Layer werden neu geladen und es werden zusätzlich die
Kreuzungs- und Kurvenpunkte angezeigt. </para>

<sect1>
<title>Straßen-Editor</>

<para>
Mit Klick auf das Menü <guimenu>Bearbeiten</> >
<guimenuitem>Straßen-Editor</> wird ein Fenster mit einigen
Editieroption geöffnet.

<sect2 id="newstreets">
<title>Neue Straßen hinzufügen</>

<para>
Durch Klicken auf die Karte kann ein Straßenzug zusammengestellt
werden. Für nicht bestehende Punkte muss man gleichzeitig die
Shift-Taste gedrückt halten. Bei bereits bestehenden Punkten (also
Kreuzungspunkten) darf die Shift-Taste nicht verwendet werden. Kreuzt
eine neue Straße eine bestehende Straße, ohne dass bereits ein
Kreuzungspunkt existiert, muss zuerst ein neuer Kurvenpunkt im
bestehenden Straßenzug erzeugt werden (siehe <link
linkend="insertpoint">Punkt einfügen</>). Falls es sich bei der
Kreuzung um eine Brücke handelt, darf kein gemeinsamer Punkt erzeugt
werden. Stattdessen sollte ein informeller Eintrag in der Datei
<filename>brunnels</> erzeugt werden.

<para>
Nachdem die neue Straße zusammengestellt wurde, muss sie per "Add new
to:" zu einer Datei, normalerweise <filename>strassen</> (in Berlin),
<filename>landstrassen</> (im näheren Umland von Berlin) oder
<filename>landstrassen2</> (im entfernteren Umland von Berlin und
außerhalb von Brandenburg) hinzugefügt werden. Im nachfolgenden Dialog
wird der Straßenname und die Kategorie eingetragen, die Koordinaten
des Straßenzugs sind bereits eingetragen.

<sect3>
<title>Regeln bei Straßennamen</>

<para id="officialstreetnames">
In Berlin (<filename>strassen</>) werden nur "offizielle"
Straßennamen verwendet. Offizielle Straßennamen sind in der Datei
<filename>Berlin.coords.data</> aufgelistet.

<para>
Es kann aber durchaus sein, dass in dieser Datei Straßen fehlen. In
diesem Fall muss die Straße mit Bezirks-/Ortsteilsname (nicht die
neuen Superbezirksnamen verwenden!), Postleitzahl und einem
exemplarischen Punkt eingetragen werden. "...straße" wird
immer als "...str." abgekürzt. Straßen, die durch mehrere
Ortsteile und/oder Postleitzahlgebiete führen, müssen dementsprechende
viele Einträge erhalten.

<para>
Wenn eine Straße in mehreren Bezirken vorhanden ist, muß der Bezirk im
Klammern dahinter stehen. Beispiele:

<programlisting>
    Methfesselstr.
    Kurfürstenstr. (Schöneberg)
    Heerstr. (Spandau, Charlottenburg)
</programlisting>

<para>
Wenn es sich innerhalb Berlins um eine "inoffizielle"
Straße handelt, muss die Straße in Klammern gesetzt werden. Das können
Wege in Parks sein oder namenslose Verbindungen. Beispiele:

<programlisting>
    (Parkweg im Volkspark Friedrichshain)
    (zur Eisenbahnbrücke)
</programlisting>

<para>
Bei Verbindungsbezeichnungen sollte ein Bindestrich verwendet werden
und die beiden Punkte in der richtigen Reihenfolge (genau wie der
Straßenzug erzeugt wurde) angegeben werden. Beispiel:

<programlisting>
    (Bahndamm - Elsenstr.)
</programlisting>

<para>
Ob die richtige Reihenfolge gewählt wurde, kann später beim Routing
überprüft werden. Je nach Richtung sollte in der Routenliste

<programlisting>
    (Elsenstr. -) Bahndamm
    (Bahndamm -) Elsenstr.
</programlisting>

erscheinen.

<para>
In den Landstraßendateien sollten die Straßennamen möglichst so
gewählt werden, dass sie in der Realität bestehenden Wegweisern
entsprechen. Ist das nicht bekannt, nimmt man die benachbarten Orte.
Eine Straßennummerierung wird vorangestellt oder in Klammern angefügt.
Zurzeit werden nur Bundesstraßen bei der Straßennummerierung
verwendet. Beispiele:

<programlisting>
    B1: Potsdam - Brandenburg
    Müncheberg - Prötzel (B168)
    Prenzlau - Penkun
            ^ ^ Hier muss immer ein Leerzeichen stehen!
    Strausberg-Nord - Altlandsberg
              ^ Bei zusammengesetzten Ortsnamen darf kein
                Leerzeichen stehen!
</programlisting>

<para>
Nach dem Einfügen der Straße ist diese nicht sofort sichtbar, sondern
die Straße muss mit "Reload" neu geladen werden. <warning><para>
Manchmal funktioniert "Reload" nicht, dann muss der Layer aus- und
wieder eingeschaltet werden.</warning> <tip><para>Um das Laden zu
beschleunigen kann im Layermenu "Lazy drawing" verwendet werden.</tip>
<warning><para>"Lazy drawing" führt zu einem Speicherleck, der zu
einem stetigen Speicherzuwachs in BBBike führt.</warning>

<sect2>
<title>Attribute zu einer Straße hinzufügen</>

<para>
Nach dem Reload ist die neue Straße sichtbar. Man kann sich wieder
den Straßenzug zusammenklicken (den ganzen Teil oder nur einen Teil
davon) und diesen Straßenzug mit "Add to new" zu einer
Attributdatei hinzufügen. Hier muss darauf geachtet werden, dass
<!-- b -->alle<!-- /b --> Punkte auf bestehenden Kurvenpunkten liegen
(Shift-Maustaste ist hier verboten) und dass kein Punkt vergessen oder
doppelte angeklickt wurden.<footnote> <para> Eine weitere
Möglichkeit der Punktauswahl wäre eine normale Suche (dazu in
den Suchmodus gehen). Nach der Suche müssen die Punkte per
Bearbeiten > Path to Selection in die X11-Selection übertragen
werden. Grundsätzlich muss Suche > Straßennetz neu berechnen
ausgewählt werden, wenn eine gerade neu eingefügte Straße
attributiert werden soll. </para> </footnote>

<para>
Mögliche Attribute sind Fahrbahnqualität (<filename>qualitaet_s</> für
Berliner, <filename>qualitaet_l</> für Nicht-Berliner Straßen),
sonstige Beeinträchtigungen (<filename>handicap_s</> für Berliner,
<filename>handicap_l</> für Nicht-Berliner Straßen), Radwege
(<filename>radwege</filename> für Berlin,
<filename>comments_cyclepath</> außerhalb Berlins) usw. Eine Liste der
Attributierungsdateien befindet sich in <ulink url="bbd.html">der
Dokumentation zum bbd-Format</>. Hier sind auch die verwendeten
Kategorien beschrieben. <!-- TODO: --> <!-- bbd.pod übersetzen? -->

<sect2>
<title>Die orig-Dateien konvertieren</>

<para>
Die im Edit-Modus bearbeiteten Dateien sind die Dateien im Verzeichnis
<filename>data</> mit der Endung <filename>-orig</>. BBBike im
Normalmodus verwendet die Dateien ohne die Endung <filename>-orig</>.
Die Konvertierung wird vom Makefile im Verzeichnis data vorgenommen.
Das Makefile funktioniert nur mit einem modernen BSD-make. Alle
Nicht-BSD-Systeme (auch Linux) benötigen dieses make, dass bei <ulink
url="http://www.sourceforge.net/projects/srezic">Sourceforge</> als
"pmake" <!-- oder BSD make, check! --> im Quellcode erhältlich ist.
Eine Windows-Binary existiert noch nicht.
<!-- check, ob "make install" bei pmake existiert und das -->
<!-- original-make überschreiben würde, böse, böse -->

<para>
Mit <command>make</> im <filename>data</>-Verzeichnis wird eine
Konvertierung vorgenommen und, wichtiger, eine Reihe von
Konsistenzchecks durchgeführt. So müssen beispielsweise alle Straßen
in <filename>strassen</> auch in <filename>Berlin.coords.data</>
aufgeführt sein (siehe auch <link
linkend="officialstreetnames">oben</link>),
<filename>Berlin.coords.data</> muss sortiert sein, alle Ampeln müssen
sich auf Kurvenpunkten existieren, alle Attributedaten müssen auf
bestehenden Straßenzügen liegen usw.

<sect2 id="insertpoint">
<title>Punkt hinzufügen</>

<para>
Im Straßen-Editor gibt es zwei Möglichkeiten zum Einfügen eines
Punktes in eine bestehende Seite.

<para>
Mit "Insert point" kann mit einem einfachen Mausklick auf eine Straße
an dieser Stelle ein Punkt ausgewählt werden. Danach erscheint ein
Dialog, wo man das Einfügen bestätigt, unter Umständen per Checkbox
nur für bestimmte Layer. Nach dem Bestätigen kann per "Reload" der
neue Punkt sichtbar gemacht werden. Achtung! Beim Bestätigen sollte
man den angezeigten Straßennamen überprüfen. Stimmt dieser nicht
überein, so muss das Hinzufügen des Punktes abgebrochen werden, und
der Straßen-Layer aus- und wieder eingeschaltet werden (bekannter Bug
in BBBike). "Insert point" ist ein Modus, der ein- und ausgeschaltet
werden muss.

<para>
Mit "Insert multiple points" können mehrere Punkte zwischen zwei
benachbarten Kurvenpunkten eingefügt werden. Dazu klickt man zuerst
den ersten Kurvenpunkt an (ohne Shift), dann die einzufügenden Punkte
(mit Shift) und schließlich den zweiten Kurvenpunkt an. Jetzt wählt
man "Insert multiple points" aus. Ein Dialog erscheint, wo man das
Einfügen bestätigen muss und kann dann auf Reload drücken. Der bei der
ersten Methode erwähnte Bug tritt hier nicht auf.

<sect2>
<title>Punkt verschieben</>

<para>
Mit "Move points" kann ein Punkt verschoben werden. Das wird man z.B.
machen, wenn man anhand eines GPS-Tracks feststellt, dass eine Straße
verschoben ist. Zum Verschieben klickt man zuerst den zu
verschiebenden Punkt an (ohne Shift) und dann das Ziel (mit oder ohne
Shift, je nachdem, ob das Ziel ein existierender Kurvenpunkt ist), und
schließlich "Move points". Der Dialog mit den betreffenden Layern wird
angezeigt und kann bestätigt werden. Achtung: einige Punkte sollten
nur bei genauer vorheriger Überprüfung verschoben werden. Dazu zählen
Endpunkte (im Dialog mit "endpoint" markiert), Höhenpunkte, Ampeln u.ä.

<sect2>
<title>Linie verschieben</>

<para>
Eine bestehende Linie zwischen zwei Punkten kann verschoben werden.
Man benutzt diese Funktion anstelle von "Move point", wenn einer der
Punkte bereits für eine andere Straße an der richtigen Stelle steht.
Arbeitsweise: die beiden benachbarten Punkte der zu verschiebenden
Strecke mit Klick markieren (ohne Shift), wobei der zweite Punkt der
zu verschiebende ist. Dann wird der Zielpunkt mit Klick ausgewählt
(meistens mit Shift). "Move line" auswählen, Dialog bestätigen und
evtl. ein Reload durchführen.

<sect2>
<title>Punkt suchen</>
<para>
Mit "Grep point" kann nachgeschaut werden, in welchen Layern ein Punkt
vorkommt. Die Vorgehensweise ist: Punkt per Klick markieren und dann
auf "Grep point" klicken.

<sect2>
<title>Linie suchen</>
<para>
Mit "Grep line" kann nachgeschaut werden, in welchen Layern eine Linie
mit zwei benachbarten Punkten vorkommt. Die Vorgehensweise ist: zwei
Punkte per Klick markieren und dann auf "Grep line" klicken.

<sect2>
<title>Punkt löschen</>
<para>
Dieser Punkt muss noch mehr als "Einen Punkt bewegen" mit Vorsicht
behandelt werden. Auch hier gilt, dass Höhenpunkte und Ampeln
normalerweise nicht gelöscht werden sollen. Bei Strecken muss darauf
geachtet werden, dass mindestens zwei Punkte in der Strecke übrig bleiben.

<sect2>
<title>Koordinatenliste anzeigen</>

<para>
Eine Koordinatenliste (kann auch aus einem einzelnen Punkt bestehen)
markieren und mit "Copy" im jeweiligen Programm auswählen
(Unix-Benutzer müssen in der Regel nur markieren). In BBBike den
Menüpunkt Bearbeiten > Linienkoordinaten anzeigen auswählen. Nach Klick
auf dem Button wird der Kartenausschnitt verschoben und die Punkte der
Koordinatenliste blinken auf. Mit der Option "Ständige Markierungen"
bleibt die Markierung ständig bestehen, ansonsten verschwindet sie
nach wenigen Sekunden.

<sect1>
<title>Veröffentlichen der Ergänzungen</>

<para>
Bei der Verwendung des Straßen-Editors wird eine Logdatei in
<filename>data/datachange.log</> geschrieben. Diese Datei sollte an
den <ulink url="mailto:slaven@rezic.de">Maintainer der
BBBike-Stammdaten</> geschickt werden. In der Datei ist auch jeweils
ein Zeitstempel pro Tag enthalten; es reicht aus, wenn nur die
neuesten Änderungen abgeschickt werden. Zugleich sollte ein diff
geschickt werden. Dieses wird mit <command>cvs diff -u data >
data.diff</> aus dem ausgecheckten BBBike-Verzeichnis heraus gemacht.
Die diff-Datei namens <filename>data.diff</> sollte dann ebenfalls an
den Maintainer geschickt werden.

<sect1>
<title>Nach dem Veröffentlichen</>

<para>
Es ist empfehlenswert, das Verzeichnis <filename>data</> nach dem
Veröffentlichen umzubenennen (oder zu löschen) und das alte
Verzeichnis mit <command>cvs update -d</> wiederherzustellen. Der
Grund sind mögliche CVS-Konflikte, die auftreten können, nachdem der
Maintainer die editierten Daten ins CVS eingepflegt hat.

<sect1>
 <title>Erfassen anhand eines GPS-Tracks</>

<para>
GPS-Tracks können entweder als zusätzlicher Straßen-Layer oder
(bevorzugt für Tracks im <ulink
url="http://www.ncc.up.pt/gpsman/">gpsman</>-Format) über den
Menüpunkt Layer zeichnen > Gpsman-Daten zeichnen dargestellt werden.
Im letzteren Fall sollten sich die GPS-Tracks im Verzeichnis
<filename>bbbike/misc/gps_data/</> im Dateinamenformat
<filename>YYYYMMDD.trk</> für Tracks und <filename>YYYYMMDD.wpt</> für
Waypoints befinden.
</para>

<para>
Straßen müssen manuell eingetragen werden (siehe <link
linkend="newstreets">Neue Straßen hinzufügen</>). Man darf GPS-Tracks
nicht 100%ig trauen, da bei schlechten Sichtverhältnissen zu den
Satelliten (Straßenschluchten, im Wald) oder Reflexionen von
Hochhäusern verfälschte Punkte auftreten können.
</para>

<para>
Bei dargestellten Gpsman-Tracks wird die jeweilige Geschwindigkeit
farblich kodiert (der Farbverlauf kann vor dem Zeichnen nach Belieben
eingestellt werden). Das kann helfen, um z.B. schlechte Wegabschnitte
nachträglich zu identifizieren. Genauer ist es meist, wenn man
zusätzlich zum Track auch die zugehörigen Waypoints zeichnen lässt.
Während der Radtouren setzt man dann an "interessanten" Stellen, z.B.
bei Qualitätsänderungen (Asphalt -&gt; Kopfsteinpflaster) einen
Waypoint.
</para>

<para>
Steigungen können nur bei GPS-Geräten mit barometrischen Höhenmesser
einigermaßen zuverlässig bestimmt werden. Obwohl GPS-Geräte absolute
Höhenangaben erzeugen, sollten diese nicht verwendet werden, weil dazu
die Geräte höhenkalibriert sein müssen. Stattdessen kann man die
relative Höhenänderung in eine Prozentangabe übersetzen und in die
Datei <filename>comments_mount</> eintragen.
</para>

<sect1>
<title>Ein Exkurs über die verwendeten Attribute</>
<para>
Grundsätzlich ist die Lektüre der <ulink url="bbd.html">Dokumentation
des bbd-Formats</> (leider nur englisch) empfehlenswert.

<sect2>
<title>Plätze</>
<para>
Plätze, die einen eigenständigen Straßenzug beschreiben, sollten in
<filename>strassen</> eingetragen werden. Plätze, die nur mit einem
Punkt beschrieben werden, sollten in <filename>plaetze</> eingetragen
werden. Plätze, die sich auf einem bestehenden Straßenzug befinden,
sollten ebenso nach <filename>plaetze</>. Wenn ein Platz in
<filename>plaetze</> eingetragen wurde, dann müssen sich alle Punkte
des Platzes auf einer bestehenden Straße befinden.

<sect2>
<title>Qualität</>
<para>
Fahrbahnbeschaffenheit wie Asphalt, Kopfsteinpflaster, Waldweg usw.
Kombinationen sind im Beschreibungsteil möglich, z.B. "schlechtes
Kopfsteinpflaster mit Sandbanketten" oder "schlechte sandige Straße,
Ausweichen auf Gehweg möglich". In der Regel sollte man die
schlechtere Kategorie für solchen Fälle wählen.

<para>
Dateinamen: <filename>qualitaet_s</> und <filename>qualitaet_l</>

<sect2>
<title>sonstige Beeinträchtigungen</>

<para>
Manchmal auch als "sonstige Behinderungen" oder "handicap" bezeichnet.
Hier kommt alles herein, was, salopp gesprochen, nicht rüttelt, aber
dennoch zu einer langsameren Fahrweise zwingt. Beispiele wären
Fußgängerzonen, Parkwege mit vielen Fußgängern, enge und kurvenreiche
Wege, aber auch Wege mit Bordsteinen (letzteres könnte in Zukunft
anders gelöst werden). Notorisch zugestaute Straßen (z.B. die
Friedrichstraße in Berlin-Mitte) könnten theoretisch hier auch
aufgeführt werden.

<para id="handicaptemporary">
Temporäre Beeinträchtigungen werden mit einer
<constant>temporary</>-Direktive versehen und können noch den Zusatz
<constant>::inwork</> erhalten (Beispiel <constant>q4::inwork</>). Der
Beschreibungstext sollte zudem das Datum der Aufhebung im Format
YYYY-MM-DD enthalten, so dass das Postprocessing rechtzeitig das
Ablaufen anzeigen kann.

<para>
Dateinamen: <filename>handicap_s</> und <filename>handicap_l</>

<sect2>
<title>Radwege</>

<para>
In Berlin wird versucht, genau zu kategorisieren, siehe auch <ulink
url="bbd.html#CYCLE_PATHS_RADWEGE_">die entsprechende Dokumentation in
der <filename>bbd</>-Dokumentation</>. Ob ein Radweg
benutzungspflichtig ist, ändert sich in Berlin häufig und man merkt
sich dieses Merkmal beim Vorbeifahren schlecht, so dass eine
Fehlkategorisierung mit <constant>RW1</> statt <constant>RW2</>
verziehen wird. Der Unterschied zwischen Suggestivstreifen und Radspur
ist nicht immer klar ersichtlich. Bei Busspuren gibt es noch keine
Kategorisierung nach den Geltungszeiten, diese könnte im
Beschreibungsfeld stehen (das ist in den bisherigen Daten noch nicht
der Fall).

<para>
In der Berliner Umgebung wird nur mit <constant>RW</> kategorisiert
und möglichst immer das Beschreibungsfeld gefüllt.

<para>
Die Qualität des Radwegs kann nur im Beschreibungsfeld als
beschreibender Text eingetragen werden.

<para>
Dateinamen: <filename>radwege</> und <filename>comments_cyclepath</>

<sect2>
<title>Grüne Wege</>

<para>
Wege, die durch Parks und Wälder oder an Gewässern entlang führen. Es
gibt zwei Stufen, <constant>green1</> und <constant>green2</>.
<constant>green1</> wird vergeben, wenn sich der Weg im überwiegend
städtischen Gebiet befindet (z.B. Uferstraßen) oder es sich um eine
größere Straße in einem Park handelt (z.B. John-Foster-Dulles-Allee).
Die Kanaluferstraßen am Landwehrkanal würden eigentlich
<constant>green1</>-konform sein, aber die Straßen sind dort so sehr
befahren, dass sie keine "green"-Kategorisierung erhalten haben.

<para>
Im Beschreibungsfeld steht meistens der Typ wie "Uferstraße" oder
"Parkweg durch den Tiergarten".

<para>
In Vorbereitung ist die Datei <filename>comments_scenic</> wo
landschaftlich besonders schöne Strecken im Umland oder sonstige
schöne Straßen in der Stadt beschrieben werden können.

<para>
Dateiname: <filename>green</>

<sect2>
<title>Unbeleuchtete Straßen</>

<para>
Hier werden nachts unbeleuchtete Straßen eingetragen. Bei Grenzfällen,
z.B. Ausschalten der Beleuchtung zu einer bestimmten Uhrzeit, kann
diese im Beschreibungsfeld aufgeführt werden.

<para>
Dateiname: <filename>nolighting</>

<sect2>
<title>Ampeln</>

<para>
Neben Ampeln (hochdeutsch: LSA) kann man auch Bahnübergänge und
Zugbrücken unterbringen. Bei Bahnübergängen (Kategorie <constant>B</>)
kann man im Beschreibungsfeld die ungefähre Anzahl von Zügen pro
Stunde angeben.

<para>
Bei Zugbrücken (Kategorie <constant>Zbr</>) können im
Beschreibungsfeld die Sperrzeiten angegeben werden, falls welche
existieren (z.B. gesehen bei der B110 zwischen Anklam und Usedom).

<para>
Bei Ampeln wird zwischen normalen Ampeln (Kategorie <constant>X</>,
Achtung: kann sich in Zukunft ändern) und reinen Fußgängerampeln
(Kategorie <constant>F</>) unterschieden. Ampeln sind nur in Berlin
erfasst.

<para>
Mehrfachampeln werden meistens nur einfach erfast, aber theoretisch
könnte man das Beschreibungsfeld mit einer Erklärung ergänzen.

<para>
Dateiname: <filename>ampeln</>

<sect2>
<title>Steigungen</>

<para>
Drei Möglichkeiten gibt es zur Erfassung von Steigungen:

<itemizedlist>
 <listitem><para>Angabe von Höhenpunkten. In diesem Fall wird ein
 Eintrag in der Datei <filename>mount</> automatisch vom
 Postprocessing erzeugt.

 <listitem><para>Angabe einer informellen Steigung ohne Prozentangabe.
 Dies geschieht in der Datei <filename>comments_mount</>. Mann lann
 Attribute wie "steil", "stark", "flach", "lang", "wellig", "kurz" im
 Beschreibungsfeld unterbringen.

 <listitem><para>Angabe der Steigung in Prozent. Quelle für die
 Prozentzahl könnte ein Steigungsschild an der Straße oder relative
 Höhenangaben eines barometrischen Höhenmessers sein. In diesem Fall
 muss im Beschreibungsfeld "Steigung n%" stehen.
</itemizedlist>

<para>
Gefälle werden niemals angegeben, sondern ergeben sich implizit aus
der Steigung.

<para>
Dateinamen: <filename>hoehe</>, <filename>comments_mount</>,
<filename>mount</>

<sect2>
<title>Straßenbahnen</>

<para>
Wenn zwischen Straßenbahngleisen und parkenden Autos oder
Bordsteinkante wenig Platz ist, sollte ein Eintrag in dieser Datei
geschaffen werden. Faustregel wäre: ein Fahrrad mit Anhänger sollte
gebührenden Abstand zu parkendes Autos halten können und sicher von
einer Straßenbahn überholt werden. Nur in Berlin erfasst.

<para>
Dateiname: <filename>comments_tram</>

<sect2>
<title>Ausgeschilderte Radrouten</>

<para>
Beispiele für ausgeschilderte Radrouten sind der europäische
Radfernweg R1, die neuen Radialrouten in Berlin (z.B. RR10),
Berlin-Usedom, Mauerradweg. Oft sind Abschnitte zwar als Radroute
angedacht, aber (noch) nicht ausgeschildert. Es wäre gut, wenn diese
Abschnitte entsprechend markiert werden. Manche Nummerierungen werden
doppelt vergeben, so gibt es eine R1 auch in der Bernauer Umgebung. In
diesem Fall wird der "unbedeutendere" Weg genauer gekennzeichnet. Für
einige wichtige Radrouten gibt es vorreservierte Buchstabenkürzel,
z.B. "BU" für Berlin-Usedom. Diese sind in der Programmdatei
<filename>Geography/Berlin_DE.pm</> fest verdrahtet.

<para>
Dateiname: <filename>comments_route</>

<sect2>
<title>Kommentare für Streckenführungen</>

<para>
Manchmal sind Streckenführungen in der Realität nicht einfach zu
finden. Dazu werden in dieser Datei erleichternde Erklärungen
geschrieben. Beispiele wären "Ausgeschildert als ..." oder "An der
Kreuzung .../... die Straßenseite wechseln" oder "Am einsamen Haus
links abbiegen". Es gibt Punktkommentare (für einen Punkt immer
gültig, egal in welche Richtung man fährt) und Streckenkommentare
(gültig, falls man den kompletten Streckenteil fährt; wahlweise auch
in der Form, die nur für eine Richtung gültig ist).

<para>
Dateiname: <filename>comments_path</>

<sect2>
<title>Kommentare zu Fährverbindungen</>

<para>
Fährzeiten und Preise der Fähren, möglichst mit dem Stand der letzten
Aktualisierung.

<para>
Dateiname: <filename>comments_ferry</>

<sect2>
<title>Sonstige Kommentare</>

<para>
Alle Kommentare, die nicht in eine der anderen Dateien passen, kommen
hier herein.

<para>
Dateiname: <filename>comments_misc</>

<sect2>
<title>Gesperrte Straßen</>

<para>
Darunter fallen folgende Typen:

<itemizedlist>
<listitem><para>Einbahnstraßen, die auch für Radfahrer gelten
(Kategorie <constant>1</>

<listitem><para>Einbahnstraßen, die in der Praxis von Radfahrern
ignoriert werden können <constant>1s</>

<listitem><para>Für Radfahrer vollkommen gesperrte Straßen (z.B.
Kfz-Straßen wie die B96a in Altglienicke, aber siehe auch <link
linkend="strassenbab">hier</>; Kategorie <constant>2</>)

<listitem><para>Stellen, an denen getragen werden muss (Kategorie
<constant>0:n</>, wobei <constant>n</> für die Zeit in Sekunden steht,
die dabei verloren geht - hier wähle ich großzügige Zeiten, meistens
nicht unter 30 Sekunden. Zeiten über einer Minute werden ebenfalls in
Sekunden angegeben z.B. <constant>0:60</>)

<listitem><para>Drängelgitter und Ähnliches (Kategorie
<constant>BNP:n</>, auch hier steht <constant>n</> für die verlorene
Zeit)

<listitem><para>Eine gesperrte Wegführung (z.B. nicht mögliches
Abbiegen oder Überqueren einer Straße) (Kategorie <constant>3</>).
Wenn beispielsweise nur rechts abbiegen erlaubt ist, müssen alle
anderen Wegführungen (z.B. geradeaus und links) als gesperrt markiert
werden, und das sowohl für Hin- und Rückrichtung. Wenn eine
Abbiegebeschränkung durch eine Einbahnstraße verursacht wird, dann ist
eine weitere Markierung in diesem Fall nicht notwendig.</para><para> Die gesperrte
Wegführung wird typischerweise mit drei Punkten gekennzeichnet, wobei
der mittlere Punkt der Punkt mit der Einschränkung ist.

<listitem><para>Die Spezialkategorie <constant>3nocross</>, mit der
ein Straßenzug, der nicht überquert werden kann (z.B. wegen einer
Straßenbahntrasse, wegen eines nicht passierbaren Mittelstreifens oder
wegen sehr (!) starken Kfz-Verkehrs), gekennzeichnet wird. Im
Postprocessing werden die <constant>3nocross</>-Kategorien in mehrere
Strecken mit der Kategorie <constant>3</> umgewandelt.</para><para> Beispiele
findet man in den BBBike-Daten im Raum Prenzlauer Berg. In BBBike
werden die <constant>3nocross</>-Strecken mit gestrichelten orangen
Linien markiert und sind nur im Editiermodus sichtbar.

</itemizedlist>

<para>
Gesperrte Straßen für Autofahrer können in der Datei
<filename>gesperrt_car</> eingetragen werden.

<para>
Temporär gesperrte Strecken sollten mit einer Direktive
<constant>temporary</> versehen werden und unter Umständen in der
Kategorie den Zusatz <constant>:inwork</> (Achtung: hier nur ein
Doppelpunkt, aber das kann sich ändern!) erhalten (siehe auch die
<link linkend="handicaptemporary">Ausführung zu temporären Einträgen
in handicap</>).

<para>
Dateinamen: <filename>gesperrt</>, <filename>gesperrt_car</>

<sect2>
<title>Brunnels</title>

<para>
Brunnels ist die Zusammenfassung von Brücken und Tunnels. In Zukunft
werden auf BBBike-gezeichneten Karten brunnels auch als solche gemalt.
Zurzeit können die brunnels-Daten verwendet werden, um bei der
Erkennung von nicht eingetragenen Kreuzungen beizutragen (Programm
<filename>miscsrc/check_crossings</>).

<para>
Dateiname: <filename>brunnels</>

<sect2>
<title>Vorfahrtstraßen</>

<para>
Diese Datensätze bestehen aus Koordinaten für einen Straßenzug, der
Vorfahrt am mittleren Punkt besitzt. Dieser Layer kann in BBBike
gezeichnet werden, wird aber nicht weiter verwendet.

<para>
Dateiname: <filename>vorfahrt</>

<sect2>
<title id="strassenbab">Autobahnen</>

<para>
Autobahnen und Kraftfahrzeugstraßen können zu Informationszwecken in
diesem Layer aufgeführt werden. Strikt gesehen müssen die Strecken
nicht so gezeichnet sein, dass sie routingfähig sind.

<para>
Dateiname: <filename>strassen_bab</>

<sect2>
<title id="sehenswuerdigkeit">Sehenswürdigkeiten und wichtige Gebäude</>

<para>
Die Datensätze in dieser Datei bekommen die Kategorie
<constant>SW</>, oft mit vielen anderen Zusätzen. Falls es sich nur um
einen Punkt handelt, ist es einfach nur <constant>SW</>, ansonsten
<constant>F:SW</>.

<para>
Wenn zu der Sehenswürdigkeit ein Bild existiert, dann sollte das Bild
in das Unterverzeichnis <filename>sehenswuerdigkeit_img</> abgelegt
werden. Als Dateiformat sollte man möglichst ein von Perl/Tk nativ
unterstütztes wie xpm oder gif wählen (neuere Perl/Tk-Versionen können
auch jpg und png verarbeiten, aber darauf möchte ich mich erst einmal
nicht verlassen). Die Bilder sollten relativ klein sein, höchstens 50
Pixel in Breite und Höhe, und aus Grautönen bestehen und einen Alpha-
bzw. Transparenzkanal besitzen. Das Bild wird per
<constant>IMG</>-Kategorie gekennzeichnet (Beispiel siehe unten).

<para>
Es gibt einige vordefinierten Bilder wie <filename>church.gif</> (für
Kirchen), <filename>monument.gif</> (für Denkmäler), <filename>airport.gif</>
(für Flughäfen), <filename>hospital.gif</> (für Krankenhäuser) und 
<filename>touristinfo.gif</> (für Touristenbüros).

<para>
Beispiele:
<programlisting>
    IMG:sehenswuerdigkeit_img/brandenburger_tor.gif|ANCHOR:s
    (ein Bild, wobei sich die definierte Koordinate südlich vom Bild
    befindet: ANCHOR:s wie south)

    F:SW|IMG:church.gif
    (eine Kirche, wobei gleichzeitig eine Kirchensignatur sowie eine
    rote Fläche angezeigt wird)

    F:SW
    (eine allgemeine flächige Sehenswürdigkeit, hier wird ein
    Stern als Signatur angezeigt)

    IMG:sehenswuerdigkeit_img/reichstag.gif
    (ein Bild ohne Fläche und ohne Anchor-Information, hier wird
    einfach nur zentriert)
</programlisting>

In Zukunft werden die Standardbilder (church.gif) durch Kategorien
ersetzt werden.

<para>
Dateiname: <filename>sehenswuerdigkeit</>

<sect2>
<title id="fragezeichen">Fragezeichen</>

<para>
Bei der Erfassung der Kartendaten kommt es häufiger vor, dass ein 
bestimmter Aspekt (z.B. die Strassenqualität oder eine Abbiegesituation) 
unklar bleibt. Der Autor kann dies kommentieren, indem er alle Strecken 
und Punkte einträgt, bei denen er sich nicht sicher ist. Bei den 
Einträgen gibt es zwei Arten: öffentliche und nicht-öffentliche. 
Öffentliche Fragezeichen-Datensätze sind wie folgt sichtbar:

<itemizedlist>
<listitem><para>Sie werden Benutzern des Web-Interfaces von BBBike in
der Routenliste präsentiert, wenn sie die Option "Unbekannte Strecke
mit einbeziehen" auswählen.</>

<listitem><para>Benutzer der MapServer-Interfaces und des
Perl/Tk-Interfaces sehen diese Daten, wenn sie den Fragezeichen-Layer
einschalten.</>
</itemizedlist>

<para>
Nicht-öffentliche Datensätze sind z.B. im Edit-Modus sichtbar oder
beim Blick in die Datenquellen.

<para>
Einträge für die erzeugte Datei <filename>fragezeichen</> werden aus
verschiedenen Quellen zusammengetragen: aus der Originaldatei
<filename>fragezeichen-orig</> (aber auch nicht alle!) sowie aus mit
<constant>add_fragezeichen</>-Direktiven versehenen Datensätzen. Die
Regeln sehen wie folgt aus:

<itemizedlist>
<listitem><para>
Alle Einträge in <filename>fragezeichen-orig</>, die in Sections

<programlisting>
        #: section ignorieren vvv
        ...
        #: section ^^^
</programlisting>
stehen, werden nicht in die öffentliche
<filename>fragezeichen</>-Datei übernommen. 
</>

<listitem><para>
Die Direktive
<programlisting>
        #: add_fragezeichen: ...
</programlisting>
in einer beliebigen Datendatei (<filename>*-orig</>) übernimmt den 
nachfolgenden Eintrag in die <filename>fragezeichen</>-Datei. 
Diese sind aber im Edit-Modus nicht sichtbar, da sie nicht auch in 
die Datei <filename>fragezeichen-orig</> übernommen werden.
</>

<listitem><para>
Die Direktive
<programlisting>
        #: XXX: ...
</programlisting>
ist ein nicht-öffentlicher Kommentar, der aber nirgends visualisiert
wird (das wird sich in Zukunft ändern!)
</>

<listitem><para>
Alle Einträge in <filename>fragezeichen-orig</>, die die Direktive
<programlisting>
        #: XXX ...
</programlisting>
haben, besitzen demnach zwei Kommentare: einen öffentlichen (den Namen
im Datensatz) und den nicht-öffentlichen (der Text hinter der
<constant>XXX</>-Direktive).
</>

</itemizedlist>

<para>
Da alle Fragezeicheneinträge in der Datei <filename>fragezeichen</> im
Webinterface angezeigt werden können, sollte der Text
allgemein verständlich sein. Insbesondere geht die Information darüber
verloren, in welcher Datei sich eine
<constant>add_fragezeichen</constant>-Direktive befand (befindet sie
sich z.B. in <filename>qualitaet_s-orig</>, dann sollte im Text auch
klar werden, dass es sich um eine Frage nach der Qualität handelt).
Auch geht ein Teil des geographische Kontexts verloren: in der
Routenbeschreibung wird nicht ersichtlich, um welche Teilstrecke es
geht. In diesem Fall sollten die von-nach-Kreuzungen möglichst mit
angegeben werden.

<sect1>
<title>Alternative Editiermöglichkeiten</>

<sect2>
<title>Schnelles Erfassen von Daten</>

<para>
Es ist auch möglich, mit der Standardinstallation von BBBike (ohne
CVS) Daten zu erfassen, die an der Daten-Maintainer geschickt werden
können. Dazu muss einfach ein Straßenzug zusammengeklickt werden,
indem man die Shift-Maustaste verwendet. Nach Auswählen des
Menüpunktes Bearbeiten > Path to Selection (dazu muss die <link
linkend="bbbikeadvanced">Option Advanced</> aktiviert sein) steht die
Koordinatenliste als Selection zur Verfügung und kann mit "Paste" in
einen Editor oder ein Mailprogramm eingefügt werden. Es ist für den
Maintainer hilfreiche, wenn dabei das normale BBBike-Datenformat
verwendet wird, also
<programlisting>
    Bechreibung    TAB    Kategorie oder X   Space    Koordinatenliste
</programlisting>

<sect2>
<title>Direktes Editieren der Daten</>

<para>
BBBike-Daten sind reine Textdateien und können mit einem normalen
Texteditor bearbeitet werden. Allerdings wird dabei kein
<filename>datachange.log</> erzeugt und das Zusammenführen mit den
Stammdaten könnte in Handarbeit resultieren. Deshalb sollte möglichst
immer der Straßen-Editor verwendet werden. In einigen Fällen ist aber
weitergehendes Editieren möglich. Für die genauere Beschreibung des
BBBike-Datenformats siehe <ulink url="bbd.html">hier</>.

<sect1>
<title>Neue Layer auf Basis der Berliner BBBike-Daten</>

<para>
TBD
<!-- Normales Straßeneditieren wie oben beschrieben, allerdings mit einigen -->
<!-- Ausnahmen: ein Einfügen von Punkten in vorhandenen Straßendaten sollte -->
<!-- nicht durchgeführt werden. Das impliziert, dass Kreuzungen nicht -->
<!--erstellt werden können, wo keine Kurvenpunkte existieren (eine -->
<!--Lösung für dieses Problem muss noch erarbeitet werden). TODO: Nach -->
<!--dem Editieren sollte ein Postprocessing durchgeführt werden, das -->
<!--für alle Punkte, die sowohl im neuen als auch in einem -->
<!--existierenden Layer verwendet werden, eine Id erzeugt. Die Id muss -->
<!--einen benutzereindeutigen Prefix besitzen. Die Id-Datei muss -->
<!--zentral eingespeist werden. Punktverschiebungen von Punkten, die -->
<!--eine ID besitzen, ist nur für minimale Korrekturen erlaubt, -->
<!--Löschungen von solchen Punkten ist erlaubt. Empfehlung für eigene -->
<!--Layer: zwei Dateien erstellen, z.B. "meine_wanderwege" und -->
<!--"wanderwege". Die erste Datei wird periodisch zur anderen -->
<!--hinzugefügt. -->


<sect1>
<title>Eine komplett neue Datenbank aufbauen</>

<para>
Dazu sollte ein neues Datenverzeichnis parallel zu
<filename>data</>-Verzeichnis erzeugt werden. Das Verzeichnis sollte
alle Dateien aus <filename>data</> enthalten (Unterverzeichnisse
können erst einmal ignoriert werden), aber alle Dateien sollten leer
(d.h. 0 Bytes größ) sein (Ausnahmen: <filename>Makefile</>,
<filename>Makefile.mapfiles</>, <filename>BASE</>, <filename>README</>
- diese Dateien sollten unverändert gelassen werden).
</para>

<para>
Das neue Datenverzeichnis sollte bevorzugt einen Namen im Format
<filename>data_&lt;stadt&gt;_&lt;landeskuerzel&gt;</> haben, z.B.
<filename>data_hamburg_de</> (alles Kleinbuchstaben). Beim Starten von
BBBike muss dieses neue Datenverzeichnis angegeben werden:
<programlisting>
    bbbike -datadir data_hamburg_de
</programlisting>
Achtung: da manche BBBike-Tools sich auf ein hart kodiertes
<filename>data</>-Verzeichnis verlassen, könnten einige
Editieroperationen fehlschlagen. Alternativ könnte man das neue
Verzeichnis auch <filename>data</> nennen, aber ein CVS-Update würde
zu Konflikten führen.
</para>


</sect1>
</article>

