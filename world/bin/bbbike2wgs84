#!/bin/sh
# Copyright (c) 2010 Wolfram Schneider, http://bbbike.org
#
# bbbike2wgs84 -  convert original bbbike data for berlin to wgs84

# name of OSM city
city=berlin
data_osm=data-osm

# die on exit
set -e

rm -rf ${data_osm}/$city
mkdir -p ${data_osm}/$city

cd data

for i in `ls -d [a-z]* Berlin* Potsdam*| egrep -v '^opensearch|-orig$'`
do
    if [ -f $i ]; then
	iconv -f iso8859-1 -t utf-8  $i | 
	  perl -npe '
	        $. == 1 && print "#:encoding: utf-8\n";
		s,-\*- coding: iso-8859-1 -,-\*- coding: utf-8 -,;
		' |
	  ../miscsrc/convert_coordsys2 standard polar > ../${data_osm}/$city/$i 2>/dev/null
    fi
done


cd ..
world/bin/opensearch-suggestion < ${data_osm}/$city/strassen > ${data_osm}/$city/opensearch.streetnames
world/bin/osm2bbd-workarounds-streets ${data_osm} $city 

cp ${data_osm}/Berlin/meta.yml ${data_osm}/$city
cp ${data_osm}/Berlin/meta.dd ${data_osm}/$city

( 
  cd ${data_osm}/$city
  rm -f inaccessible_*.old
  for i in inaccessible_* 
  do 
	mv $i $i.old
  done
)

