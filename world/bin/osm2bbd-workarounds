#!/bin/sh
# Copyright (c) 2009-2011 Wolfram Schneider, http://bbbike.org
#
# osm2bbd-workarounds - wrapper script for osm-to-bbbike data conversion


prefix=$1
city=$2

if test -z "$prefix" -o -z "$city"; then
	echo "usage $0 prefix city"
	exit 2
fi

p=`pwd`/world/bin

perl ./miscsrc/osm2bbd-postprocess --debug=0 --force \
	-only-largest-city-is-center \
	-skip-inaccessible-streets \
	--city-names="`world/bin/bbbike-db --city-names $city`" \
	--neighbours="`world/bin/bbbike-db --neighbours $city`" \
	--local-lang=`world/bin/bbbike-db --local-lang $city` $prefix/$city

if [ $? != 0 ]; then
	echo "failed $city"
	exit $?
fi

cd $prefix/$city || exit 2
$p/strasse-str strassen

cat /dev/null > Berlin.coords.data

perl $p/opensearch-suggestion --gps=0 < strassen > opensearch.streetnames

# green ways
# perl -npe 's/^\s/XYZ\t/; s/RW1/green2/g' radwege_exact > green 

for i in Berlin.coords.data Potsdam.coords.data comments_mount flaechen green nolighting plaetze qualitaet_s rbahn rbahnhof sbahn sbahnhof strassen ubahn ubahnhof wasserstrassen faehren `find . -type f -size 0`
do

	if ! [ -s $i ]; then

cat << EOF > $i
#: #: -*- coding: utf-8 -*-
#:encoding: utf-8
#:map: polar
#:date: fixed
#:
EOF
	fi
done

#rm -f _* *.bak
rm -f *.bak
ls | egrep -v '\.gz' | egrep "^_" | xargs gzip -f

