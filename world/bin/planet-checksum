#!/bin/sh
# Copyright (c) 2012 Wolfram Schneider, http://bbbike.org
#
# planet-checksum - bitrot checksum test of latest planet osm file
#

set -e

: ${MD5=`which md5 md5sum false | head -1`}
nice="nice -n 9"

: ${file=planet-latest.osm.pbf}
dir=$HOME/projects/osm/download

cd $dir

tmp=$(mktemp -t md5.XXXXXXXXXXX)
$nice $MD5 $file > $tmp

if diff $file.md5 $tmp; then
   :
else
   $nice $MD5 *.bz2 *.pbf
   $nice $MD5 $file
   cat $file.md5 
fi

rm -f $tmp
