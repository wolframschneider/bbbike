#!/usr/local/bin/perl
# Copyright (c) 2009-2011 Wolfram Schneider, http://bbbike.org
#
# cities-parallel - make wrapper to extract N cities at the same time on a multi-core machine 

use strict;
use warnings;

my $split     = shift || 1;
my $make_args = shift || 'cities';

my $hash;

my $i;
while (<>) {
    chomp;

    $i = $. % $split;
    push( @{ $hash->{$i} }, $_ );
}

foreach my $key ( sort { $a <=> $b } keys %$hash ) {
    print qq{time make -s CITIES="}, join " ", @{ $hash->{$key} },
      qq{" $make_args > tmp/log.$split.cities.$key 2>&1 &\n};
}
print "wait\n";

