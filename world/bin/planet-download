#!/bin/sh
# Copyright (c) 2009-2010 Wolfram Schneider, http://bbbike.org
#
# planet-download - download the latest planet osm file
#

if [ -n "$IGNORE_PLANET_OSM" ]; then
	exit 0
fi

: ${MD5=`which md5 md5sum | head -1`}
file=planet-latest.osm.bz2
file_bpf=`basename $file .bz2`.pbf

mv -f $file.md5 $file.md5.old.$$
mv -f $file $file.old.$$
mv -f $file_bpf $file_bpf.old.$$

server1=http://ftp5.gwdg.de/pub/misc/openstreetmap/planet.openstreetmap.org
#server2=http://ftp.ecki-netz.de/osm
#server2=$server1
#server1=http://ftp.heanet.ie/mirrors/openstreetmap.org
#server1=http://planet.openstreetmap.org

wget -nv $server1/$file.md5
cat $file.md5

#wget -nv $server1/$file
time curl -L -sS $server1/$file | tee $file | pbzip2 -dc | buffer | \
  time osmosis  --rx enableDateParsing=no /dev/stdin --buffer bufferCapacity=2000 --write-pbf $file_bpf

$MD5 $file

