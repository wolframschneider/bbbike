#!/bin/sh
# Copyright (c) 2012 Wolfram Schneider, http://bbbike.org
#
# pbf2pbf - fix PBF format

set -e

logfile=$(mktemp -t _pbf2pbf.XXXXXXXX)

args=""
for f 
do
   args="$args --read-pbf $f --bb left=-180 right=180 top=90 bottom=-90 clipIncompleteEntities=true --write-pbf omitmetadata=true $f.tmp"
done


if osmosis $args > $logfile 2>&1
then
    for f 
    do
	mv -f $f.tmp $f
        chmod 664 $f
    done
    rm -f $logfile
else
    echo "File $@ failed"
    cat $logfile
    exit 2
fi 

