#!/bin/sh
#
# extract street names coords from an OpenStreetMap XML dump and
# compute the region area (country, state)
#

download_dir=$HOME/osm/download

cd $download_dir || exit 2

outdir=`mktemp -d /tmp/osm-gps.XXXXXXXXXXXXXXX` || exit 2

#
# select osm files, sort by file size, largest first
#
find [a-e]* south-america.osm.bz2 europe north-america.osm.bz2 -name '*.bz2' -type f -print | \
	perl  -e 'while(<>) { chomp; $a{$_}=1 }; 
		  map { $size{$_} = (stat($_))[7] } keys %a; 
		  @b =reverse sort {$size{$a} <=> $size{$b}} keys %a; 
		  print join("\n", @b)' | xargs -n1 -P`ncpu` osm-gps-region


zcat $outdir/*.gz | sort -uf | gps-region-reduce 
rm -rf $outdir



